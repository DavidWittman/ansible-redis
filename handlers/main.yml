---
# Handler to create the "real" redis config file: this will be re-written by
# redis.
- name: enforce new redis config file
  copy:
    remote_src: yes
    src: /etc/redis/{{ redis_port }}.refconf
    dest: /etc/redis/{{ redis_port }}.conf
    owner: "{{ redis_user }}"
    mode: 0640

# Handler to create the "real" sentinel config file: this will be re-written by
# sentinel.
- name: enforce new sentinel config file
  copy:
    remote_src: yes
    src: /etc/redis/sentinel_{{ redis_sentinel_port }}.refconf
    dest: /etc/redis/sentinel_{{ redis_sentinel_port }}.conf
    owner: "{{ redis_user }}"
    mode: 0640

- name: "restart redis {{ redis_port }}"
  service:
    name: "{{ redis_service_name }}"
    state: restarted
  # do not restart if redis was just installed
  # this prevents redis from starting and then re-starting
  # in most cases
  when: redis_as_service and (not redis_installed.changed)

- name: "restart sentinel {{ redis_sentinel_port }}"
  service:
    name: sentinel_{{ redis_sentinel_port }}
    state: restarted
  # do not restart if redis was just installed
  # this prevents sentinel from starting and then re-starting
  # in most cases
  when: redis_as_service and (not redis_installed.changed)
